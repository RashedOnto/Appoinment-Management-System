@model IEnumerable<AppointmentManagementSystem.Models.Branch>

@{
    ViewData["Title"] = "Index";
    int count = 1;
}
<style>
    .control-label, .form-control, .Font-Size {
        font-size: 15px;
    }
</style>
<div class="bg-white p-3 ml-2 mr-2">
    <div class="row">
        <div class="col-6">
            <h4 class="float-left">Branch List</h4>
        </div>
        <div class="col-6">
            <button class="btn btn-primary float-right Font-Size mb-2" onclick="AddBranch()"><i class="fa fa-plus mr-1"></i>Add Branch</button>
        </div>
    </div>
    <div id="ErrorMsg" style="text-align: center;" class="col-md-12">
        <label style="color:green" class="col-md-12"><span id="SuccessMessageDiv">@ViewBag.SuccessMessage</span></label>
        <label style="color:red" class="col-md-12"><span id="ErrorMessageDiv">@ViewBag.ErrorMessage</span></label>
    </div>
    @*<div class="col-md-12 text-center" id="tableData"><img id="loader" style="display:none; width: 20%; margin-top:5%; margin:auto" src="~/Images/loder.gif" /></div>*@
    <div class="table-responsive" id="branchTable">
        <div class="col-md-12 text-center">
        <img class="text-center" id="loader" style="display:none; width: 20%; margin-top:5%; margin:auto; filter: grayscale(100%) brightness(50%) sepia(100%) hue-rotate(0deg) saturate(500%) contrast(1);" src="~/Images/loder.gif" />
        </div>
       @* <img class="text-center" id="loader" style="display:none; width: 20%; margin-top:5%; margin:auto" src="~/Images/loder.gif" />*@
    </div>
</div>
<div class="modal" tabindex="-1" id="AddBranch">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="ClearAll()" aria-label="Close"></button>
            </div>
            <div class="modal-body">               
                <div class="form-group">
                    <label>Name</label>
                    <input type="hidden" class="form-control" id="branchId" name="id" />
                    <input type="text" class="form-control" name="name" id="name" />
                </div>
                 <div class="form-group">
                    <label>Address</label>                    
                    <input type="text" class="form-control" name="address" id="address" />
                </div>
                <div class="form-group">
                    <label>Hotline</label>                    
                    <input type="text" class="form-control" name="hotline" id="hotline" />
                </div>
              
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="ClearAll()" data-bs-dismiss="modal">Close</button>

                <button type="button" class="btn btn-primary" id="btnSave" onclick="fnAddBranch()">Save</button>
                <button type="button" class="btn btn-primary" id="btnUpdate" onclick="fnUpdateBranch()">Update</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            $("#Settings").css("display", "block");
            $("#BranchList").addClass("active");
            loadData();
        });


        function ClearAll() {
            $("#name").val("");
            $("#branchId").val("");
            $("#address").val("");
            $("#hotline").val("");
          
        }
        function AddBranch() {
            $("#btnUpdate").css("display", "none");
            $("#btnSave").css("display", "block");
            $("#modalTitle").html("Add Branch")
            $('#AddBranch').modal("show");
        }
        function UpdateBranch(id, name, address, hotline) {
           
            $("#btnUpdate").css("display", "block");
            $("#btnSave").css("display", "none");
            $("#name").val(name);
            $("#address").val(address);
            $("#hotline").val(hotline);
            $("#branchId").val(id);           
            $("#modalTitle").html("Update Branch")
            $('#AddBranch').modal("show");
        }
        function fnAddBranch() {
            var name = $('#name').val();
            var address = $('#address').val();
            var hotline = $('#hotline').val();
           
            $.ajax({
                type: "POST",
                url: "/Branch/Add",
                data: { name: name, address: address, hotline: hotline },
                success: function (result) {
                    $("#SuccessMessageDiv").html("<div class='alert alert-primary'>" + result.errorMessage + "</div>");
                   // $("#SuccessMessageDiv").html("<div class='alert alert-primary' style='background-color: #008000; font-size: 16px;'>" + result.errorMessage + "</div>");

                    $('#AddBranch').modal("hide");
                    loadData();
                },
                error: function (error) {
                    loadData();
                    $("#SuccessMessageDiv").html("<div class='alert alert-danger'>" + result.errorMessage + "</div>");
                }
            });
        }
        function fnUpdateBranch() {
            var name = $('#name').val();
            var address = $('#address').val();
            var hotline = $('#hotline').val();
            var id = $('#branchId').val();           
            $.ajax({
                type: "POST",
                url: "/Branch/Update",
                data: { name: name, id: id, address: address, hotline: hotline },
                success: function (result) {
                   // $("#SuccessMessageDiv").html("<div class='alert alert-danger'>" + result.errorMessage + "</div>");
                    $("#SuccessMessageDiv").html("<div class='alert alert-primary'>" + result.errorMessage + "</div>");
                    $('#AddBranch').modal("hide");
                    loadData();
                },
                error: function (error) {
                    loadData();
                   
                    $("#SuccessMessageDiv").html("<div class='alert alert-danger'>" + result.errorMessage + "</div>");
                }
            });
        }
        function fnDeleteData(id) {
            let text = "Are you sure to delete this department?"
            if (confirm(text) == true) {
                $.ajax({
                    type: "POST",
                    url: "/Branch/Delete",
                    data: { "id": id },
                    success: function (result) {
                       // $("#SuccessMessageDiv").html("<div class='alert alert-danger'>" + result.errorMessage + "</div>");
                        $("#SuccessMessageDiv").html("<div class='alert alert-primary'>" + result.errorMessage + "</div>");
                        loadData()
                    },
                    error: function (error) {

                        loadData()
                        $("#SuccessMessageDiv").html("<div class='alert alert-danger'>" + error.errorMessage + "</div>");

                    }
                });
               
            } else {

            }
        }
        function loadData() {
            $('#loader').show();
            ClearAll();
            $.ajax({
                url: '/Branch/GetAllBranch',
                type: 'GET',
                success: function (data) {
                    var branchTable = $('#branchTable');
                    branchTable.empty();

                    var dTable = '<table class="table table-striped table-bordered custrom-table mb-2" id="table"><thead><tr><th>#</th><th>Name</th><th>Address</th><th>Hotline</th><th>Action</th></tr></thead><tbody>';

                    $.each(data, function (index, item) {
                        dTable += '<tr>' +
                            '<td>' + (index + 1) + '</td>' +                           
                            '<td>' + item.name + '</td>' +                          
                            '<td>' + item.address + '</td>' +                          
                            '<td>' + item.hotline + '</td>' +                          
                            '<td>' +
                            '<button class="btn btn-sm btn-primary" type="button" onclick="UpdateBranch(' + item.id + ',\'' + item.name + '\',\'' + item.address + '\',\'' + item.hotline + '\')"><i class="fas fa-edit" title="Edit"></i></button>' + '&nbsp;' +
                            '<button type="button" class="btn btn-sm btn-danger" onclick="fnDeleteData(' + item.id + ')"><i class="fa-solid fas fa-trash" title="Delete"></i></button>' +
                            '</td>' +
                            '</tr>';
                    });
                    dTable += '</tbody></table>';
                    branchTable.append(dTable);
                    $('#table').DataTable();
                    $('#loader').hide();
                },
                error: function () {
                    alert('An error occurred while fetching data.');
                }
            });
        }

    </script>
}
