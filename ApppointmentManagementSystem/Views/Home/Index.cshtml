@{
    ViewData["Title"] = "Home Page";
    Layout = null;
}

<link href="~/design/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
@*<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">*@
<link href="~/Design/css/datatable.min.css" rel="stylesheet" />
<link href="~/Design/css/font-awesome.min.css" rel="stylesheet" />

<style>
    body {
        background-image: url('../../Images/bg.jpg');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        background-color: rgba(255, 255, 255, 0.5);
    }

    .parent {
        position: relative;
    }

    .child {
        position: absolute;
        bottom: 0;
    }
</style>
<div class="pb-4 mx-5 mt-3">
    @if (ViewBag.UserId != null)
    {
        <div class="text-right float-end font-weight-bold">
            <div class="dropdown">
                <button type="button" class="btn btn-success dropdown-toggle p-3" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-circle-chevron-down"></i>
                </button>
                <ul class="dropdown-menu text-center bg-primary">
                    <li><a type="button" class="btn text-white" href="/Home/SelfAppointmentList"><i class="fa fa-list"></i> Appointment List</a></li>
                    <li><a type="button" class="btn text-white" href="/Account/Register?visitorId=@ViewBag.UserId&ReturnUrl=/Home/Index"><i class="fa fa-address-card"></i> Profile Update</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <form class="form-inline mb-0" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post">
                            <button type="submit" class="btn text-white"><i class="fa fa-arrow-right"></i> Logout</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    }
    else
    {
        <div class="text-right float-end font-weight-bold">
            <div class="dropdown">
                <button type="button" class="btn btn-success dropdown-toggle p-3" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-circle-chevron-down"></i>
                </button>
                <ul class="dropdown-menu text-center bg-primary">
                    <li><a type="button" class="btn text-white" href="/Account/Register?ReturnUrl=/Home/Index"><i class="fa fa-address-card"></i> Registration</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a type="button" class="btn text-white" href="/Account/VisitorLogin?ReturnUrl=/Home/Index"><i class="fa fa-arrow-right"></i> Visitor Login</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a type="button" class="btn text-white" href="/Account/Login"><i class="fa fa-arrow-right"></i> Employee Login</a></li>
                </ul>
            </div>
        </div>
    }
</div>
<div class="row bg-white rounded shadow p-4 m-5">
    <div>
        <h4 class="text-center bg-warning py-2 font-weight-bolder">FIND YOUR DOCTOR</h4>
        <div class="text-center">
            @if (ViewBag.SuccessMessage != null)
            {
                <div id="SuccessMessage" style="display: none;">@ViewBag.SuccessMessage</div>
                <div id="toast-data" data-toast-type="success" style="display: none;"></div>
            }
            @if (ViewBag.ErrorMessage != null)
            {
                <div id="ErrorMessage" style="display: none;">@ViewBag.ErrorMessage</div>
                <div id="toast-data" data-toast-type="error" style="display: none;"></div>
            }
        </div>
    </div>


    <div class="justify-content-center mt-4 mb-2">
        <form class="form-signin create-form rounded border border-primary px-5 py-3 mx-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="control-label font-weight-bolder">Select Branch Name</label>
                        @Html.DropDownList("BranchId", new SelectList(ViewBag.BranchList, "Id", "Name"), "Select Branch Name", new { @class = "form-control border border-info mt-2", @onchange = "LoadDepartmentByBranchId()" })
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="control-label font-weight-bolder">Select Department Name</label>
                        <select id="DepartmentId" name="DepartmentId" class="form-control border border-info mt-2" onchange="LoadDoctorList()">
                            <option value="">Select Department Name</option>
                        </select>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="row" id="DoctorListDiv"></div>
</div>

<script src="~/Design/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/bootstrap.bundle.min.js"></script>
<script src="~/js/sweetalert.all.min.js"></script>
<script src="~/js/SweetAlert.js"></script>
<script>

    function LoadDepartmentByBranchId() {
        var selectedBranchId = $("#BranchId").val();
        if (selectedBranchId) {
            $.ajax({
                url: "/Home/LoadDepartmentByBranchId",
                type: 'POST',
                data: { branchId: selectedBranchId },
                success: function (data) {
                    var departmentDropdown = $("#DepartmentId");
                    departmentDropdown.empty();
                    departmentDropdown.append('<option value="">Select Department Name</option>');
                    $.each(data, function (i, department) {
                        departmentDropdown.append($('<option></option>').val(department.id).text(department.name));
                    });
                }
            });
        } else {
            $("#DepartmentId").empty().append('<option value="">---Select Department Name---</option>');
        }
    }

    function LoadDoctorList() {
        var selectedDepartmentId = $("#DepartmentId").val();
        var selectedBranchId = $("#BranchId").val();
        if (selectedDepartmentId) {
            $.ajax({
                url: "/Home/GetDoctorDetailsByBranchAndDepId",
                type: 'POST',
                data: { branchId: selectedBranchId, departmentId: selectedDepartmentId },
                success: function (data) {
                    var doctorListDiv = $("#DoctorListDiv");
                    doctorListDiv.empty();
                    $.each(data, function (i, doctor) {
                        // Create the URL for DoctorProfile action
                        var doctorProfileUrl = "/Home/DoctorProfile?doctorId=" + doctor.doctorId + "&branchId=" + selectedBranchId + "&departmentId=" + selectedDepartmentId;
                        var doctorAppointmentUrl = "/Home/GetAppointment?doctorId=" + doctor.doctorId + "&branchId=" + selectedBranchId + "&departmentId=" + selectedDepartmentId;



                        doctorListDiv.append(`
                                                        <div class="col-md-6">
                                                            <div class="row rounded border border-success p-4 m-4">
                                                                <div class="col-md-4">
                                                                    <div class="text-center border border-light" style="height: 250px; width: 150px;">
                                                                        <img style="height: 100%; width: 100%;" src="${doctor.doctorImage}" alt="Doctor Image" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-8 parent">
                                                                    <h4>${doctor.doctorName}</h4>
                                                                    <p>Speciality - ${doctor.doctorSpecialty}</p>
                                                                    <p>Degree - ${doctor.doctorDegreeName}</p>
                                                                    <div class="child">
                                                                                <a type="button" class="btn btn-primary" href="${doctorAppointmentUrl}">Get Appointment</a>
                                                                        <a type="button" class="btn btn-warning" href="${doctorProfileUrl}">Doctor's Profile</a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    `);
                    });
                }
            });
        } else {
            $("#DoctorListDiv").empty();
        }
    }

</script>
